<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>DJGA Score Caddie</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>â›³</text></svg>">
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Barlow+Condensed:wght@400;600;700&family=DM+Mono:wght@400;500&display=swap');
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
:root{
  --g9:#081a10;--g8:#0f2a1a;--g7:#163824;--g6:#1d4a2e;--g5:#275e3c;--g4:#3d7a52;--g3:#5a9e70;
  --gold:#c8a44a;--gold2:#e4c56e;--gold3:#f6e9c0;
  --ink:#1c1c1c;--ink2:#444;--ink3:#777;--ink4:#aaa;
  --bg:#f2ede3;--bg2:#faf7f1;--white:#fdfdfc;
  --bdr:#e2ddd2;--r:14px;--r2:10px;--r3:7px;
}
html{font-size:16px;-webkit-text-size-adjust:100%;}
body{font-family:'Noto Sans JP',sans-serif;background:var(--bg);color:var(--ink);-webkit-font-smoothing:antialiased;}
.app{min-height:100svh;display:flex;flex-direction:column;max-width:520px;margin:0 auto;}
.topbar{background:var(--g9);padding:0 12px;display:flex;align-items:center;gap:8px;height:52px;position:sticky;top:0;z-index:100;border-bottom:1px solid rgba(200,164,74,.2);}
.topbar-back{background:none;border:none;color:rgba(255,255,255,.55);font-size:22px;cursor:pointer;padding:0 6px;line-height:1;flex-shrink:0;}
.topbar-back:active{color:var(--gold2);}
.topbar-logo{font-family:'Barlow Condensed',sans-serif;font-size:17px;font-weight:700;color:var(--gold2);letter-spacing:1px;}
.topbar-sep{width:1px;height:18px;background:rgba(255,255,255,.15);}
.topbar-info{font-size:12px;color:rgba(255,255,255,.4);line-height:1.3;}
.topbar-info strong{display:block;font-size:11px;color:rgba(255,255,255,.6);font-weight:500;}
.topbar-space{flex:1;}

.home{padding:24px 16px;flex:1;}
.home-logo{text-align:center;margin-bottom:28px;}
.home-logo-icon{font-size:56px;margin-bottom:8px;}
.home-logo-text{font-family:'Barlow Condensed',sans-serif;font-size:36px;font-weight:700;color:var(--g7);letter-spacing:3px;}
.home-logo-sub{font-size:12px;color:var(--ink3);margin-top:2px;letter-spacing:1px;}
.home-menu{display:flex;flex-direction:column;gap:10px;}
.home-btn{display:flex;align-items:center;gap:14px;background:var(--white);border:2px solid var(--bdr);border-radius:var(--r);padding:16px;cursor:pointer;transition:all .12s;text-align:left;width:100%;font-family:inherit;}
.home-btn:active{border-color:var(--g4);background:var(--bg2);}
.home-btn-icon{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:24px;flex-shrink:0;}
.home-btn-icon.icfg{background:#5c4a1e;color:var(--gold2);}
.home-btn-icon.grp{background:var(--g7);color:white;}
.home-btn-icon.rank{background:#2c5282;color:white;}
.home-btn-label{font-size:16px;font-weight:700;color:var(--ink);}
.home-btn-desc{font-size:12px;color:var(--ink3);margin-top:2px;}
.home-btn-arrow{margin-left:auto;color:var(--ink4);font-size:20px;}

.cfg{padding:16px;flex:1;}
.cfg-title{font-family:'Barlow Condensed',sans-serif;font-size:22px;font-weight:700;color:var(--g7);margin-bottom:4px;}
.cfg-sub{font-size:12px;color:var(--ink3);margin-bottom:16px;line-height:1.6;}
.cfg-card{background:var(--bg2);border:1px solid var(--bdr);border-radius:var(--r);padding:14px;margin-bottom:12px;}
.cfg-label{font-size:11px;font-weight:700;color:var(--ink3);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;display:flex;align-items:center;gap:6px;}
.cfg-input{width:100%;padding:10px 14px;border:2px solid var(--bdr);border-radius:var(--r2);font-size:14px;background:var(--white);font-family:inherit;outline:none;transition:border-color .12s;}
.cfg-input:focus{border-color:var(--g4);}
.cfg-row{display:flex;gap:8px;align-items:center;}
.cfg-sm{width:80px;padding:8px;text-align:center;border:2px solid var(--bdr);border-radius:var(--r3);font-size:15px;font-weight:700;background:var(--white);font-family:'DM Mono',monospace;outline:none;}
.cfg-sm:focus{border-color:var(--g4);}
.par-grid{display:grid;grid-template-columns:repeat(9,1fr);gap:4px;}
.par-cell{display:flex;flex-direction:column;align-items:center;gap:2px;}
.par-cell-num{font-size:10px;color:var(--ink4);font-weight:600;}
.par-cell select{width:100%;padding:6px 2px;border:1.5px solid var(--bdr);border-radius:5px;font-size:14px;font-weight:700;text-align:center;background:var(--white);font-family:'DM Mono',monospace;color:var(--ink);cursor:pointer;appearance:none;-webkit-appearance:none;}
.par-cell input{width:100%;padding:5px 2px;border:1.5px solid var(--bdr);border-radius:5px;font-size:12px;text-align:center;background:var(--white);font-family:'DM Mono',monospace;color:var(--ink2);outline:none;}
.par-cell input:focus,.par-cell select:focus{border-color:var(--g4);}
.hidden-grid{display:grid;grid-template-columns:repeat(9,1fr);gap:5px;}
.hidden-btn{aspect-ratio:1;border-radius:8px;border:2.5px solid var(--bdr);background:var(--white);font-family:'DM Mono',monospace;font-size:14px;font-weight:700;color:var(--ink3);cursor:pointer;display:flex;flex-direction:column;align-items:center;justify-content:center;transition:all .12s;gap:1px;}
.hidden-btn:active{transform:scale(.93);}
.hidden-btn.on{border-color:var(--gold);background:var(--gold3);color:var(--g7);}
.hidden-par{font-size:9px;font-weight:400;opacity:.6;}
.nine-label{font-size:11px;font-weight:700;color:var(--ink4);margin-bottom:6px;margin-top:10px;letter-spacing:1px;}

.conn-status{display:flex;align-items:center;gap:6px;padding:8px 14px;border-radius:var(--r2);font-size:12px;font-weight:600;margin-bottom:12px;}
.conn-status.ok{background:#d8f0e3;color:#1a6b35;border:1px solid #a8d8b8;}
.conn-status.err{background:#ffe4e4;color:#991111;border:1px solid #f0b0b0;}
.conn-status.loading{background:var(--gold3);color:#7a4e00;border:1px solid var(--gold);}
.conn-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0;}

.gm{padding:16px;flex:1;}
.gm-title{font-family:'Barlow Condensed',sans-serif;font-size:22px;font-weight:700;color:var(--g7);margin-bottom:4px;}
.gm-sub{font-size:12px;color:var(--ink3);margin-bottom:16px;line-height:1.6;}
.gm-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-bottom:20px;}
.gm-num{aspect-ratio:1;border-radius:var(--r3);border:2px solid var(--bdr);background:var(--white);font-family:'Barlow Condensed',sans-serif;font-size:20px;font-weight:700;color:var(--ink2);cursor:pointer;display:flex;flex-direction:column;align-items:center;justify-content:center;transition:all .12s;gap:2px;}
.gm-num:active{transform:scale(.94);}
.gm-num.has{border-color:var(--g4);background:var(--g7);color:white;}
.gm-count{font-size:9px;font-weight:400;opacity:.6;}

.gd{padding:16px;flex:1;}
.gd-header{display:flex;align-items:center;gap:10px;margin-bottom:16px;}
.gd-num{width:52px;height:52px;border-radius:14px;background:var(--g7);color:var(--gold2);display:flex;align-items:center;justify-content:center;font-family:'Barlow Condensed',sans-serif;font-size:28px;font-weight:700;}
.gd-title{font-family:'Barlow Condensed',sans-serif;font-size:20px;font-weight:700;color:var(--g7);}
.gd-subtitle{font-size:12px;color:var(--ink3);}
.gd-section{background:var(--bg2);border:1px solid var(--bdr);border-radius:var(--r);padding:14px;margin-bottom:12px;}
.gd-sec-title{font-size:11px;font-weight:700;color:var(--ink3);text-transform:uppercase;letter-spacing:1px;margin-bottom:10px;display:flex;align-items:center;gap:6px;}
.member-row{display:flex;align-items:center;gap:10px;padding:10px 0;border-bottom:1px solid var(--bdr);}
.member-row:last-child{border-bottom:none;}
.member-avatar{width:34px;height:34px;border-radius:50%;background:var(--g6);color:white;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;flex-shrink:0;}
.member-name{flex:1;font-size:14px;font-weight:600;}
.member-tee{padding:3px 10px;border-radius:99px;font-size:11px;font-weight:700;cursor:pointer;border:2px solid;transition:all .12s;background:none;font-family:inherit;}
.member-tee.white{border-color:#ccc;background:#f8f8f8;color:#555;}
.member-tee.red{border-color:#e09090;background:#fdeaea;color:#aa2222;}
.member-del{width:28px;height:28px;border-radius:50%;border:none;background:#fee;color:#c44;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.add-row{display:flex;gap:8px;margin-top:12px;}
.add-input{flex:1;padding:10px 14px;border:2px solid var(--bdr);border-radius:var(--r2);font-size:14px;background:var(--white);font-family:inherit;outline:none;}
.add-input:focus{border-color:var(--g4);}
.add-btn{padding:10px 18px;background:var(--g5);color:white;border:none;border-radius:var(--r2);font-size:14px;font-weight:700;cursor:pointer;white-space:nowrap;font-family:inherit;}
.add-btn:disabled{opacity:.4;}
.qr-section{background:var(--white);border:2px solid var(--g4);border-radius:var(--r);padding:20px;margin-bottom:12px;text-align:center;}
.qr-title{font-family:'Barlow Condensed',sans-serif;font-size:18px;font-weight:700;color:var(--g7);margin-bottom:4px;}
.qr-sub{font-size:11px;color:var(--ink3);margin-bottom:14px;}
.qr-img-wrap{display:inline-block;padding:12px;background:var(--bg);border-radius:12px;margin-bottom:12px;}
.qr-link-box{display:flex;align-items:center;gap:6px;background:var(--bg);border:1px solid var(--bdr);border-radius:var(--r3);padding:8px 12px;margin-bottom:10px;}
.qr-link-text{flex:1;font-size:11px;color:var(--ink2);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-family:'DM Mono',monospace;}
.qr-copy-btn{padding:6px 14px;background:var(--g5);color:white;border:none;border-radius:6px;font-size:12px;font-weight:700;cursor:pointer;flex-shrink:0;font-family:inherit;}
.qr-copy-btn.copied{background:var(--gold);color:var(--g9);}
.qr-hint{font-size:10px;color:var(--ink4);line-height:1.6;}

.hole-header{background:linear-gradient(180deg,var(--g8) 0%,var(--g7) 100%);padding:12px 14px 14px;border-bottom:1px solid rgba(200,164,74,.2);}
.hole-nav{display:flex;align-items:center;gap:0;margin-bottom:10px;}
.hole-nav-btn{width:40px;height:40px;border-radius:var(--r2);border:1.5px solid rgba(255,255,255,.12);background:rgba(255,255,255,.06);color:rgba(255,255,255,.7);font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.hole-dots{flex:1;display:flex;justify-content:center;align-items:center;gap:3px;padding:0 4px;}
.hole-dot{width:20px;height:20px;border-radius:5px;border:none;cursor:pointer;flex-shrink:0;font-size:9px;font-weight:700;font-family:'DM Mono',monospace;display:flex;align-items:center;justify-content:center;transition:all .12s;}
.hole-dot.empty{background:rgba(255,255,255,.1);color:rgba(255,255,255,.4);}
.hole-dot.partial{background:var(--g5);color:rgba(255,255,255,.9);}
.hole-dot.done{background:var(--g3);color:white;}
.hole-dot.active{background:var(--gold);color:var(--g9);transform:scale(1.15);font-weight:900;}
.hole-dot.startmark{box-shadow:0 0 0 2px var(--gold2);}
.hole-main{display:flex;align-items:flex-end;gap:14px;}
.hole-num{font-family:'Barlow Condensed',sans-serif;font-size:60px;font-weight:700;color:white;line-height:1;flex-shrink:0;}
.hole-meta{flex:1;padding-bottom:4px;}
.hole-badges{display:flex;align-items:center;gap:6px;margin-bottom:5px;}
.nine-badge-h{font-size:10px;font-weight:700;background:rgba(255,255,255,.1);color:rgba(255,255,255,.5);padding:2px 8px;border-radius:99px;letter-spacing:.5px;}
.hole-par-lbl{font-family:'Barlow Condensed',sans-serif;font-size:22px;font-weight:700;color:var(--gold2);}
.start-badge{font-size:10px;font-weight:700;background:var(--g8);color:var(--gold2);padding:2px 8px;border-radius:99px;}
.hole-yards{font-size:12px;color:rgba(255,255,255,.4);margin-bottom:5px;display:flex;gap:10px;}
.yard-item{display:flex;align-items:center;gap:4px;}
.yard-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0;}
.hole-progress{display:flex;align-items:center;gap:8px;}
.progress-track{flex:1;height:4px;background:rgba(255,255,255,.1);border-radius:99px;overflow:hidden;}
.progress-fill{height:100%;background:var(--g3);border-radius:99px;transition:width .4s;}
.progress-text{font-size:11px;color:rgba(255,255,255,.35);white-space:nowrap;}

.players{padding:12px;flex:1;display:flex;flex-direction:column;gap:9px;}
.pcard{background:var(--white);border-radius:var(--r);border:2px solid var(--bdr);transition:border-color .15s;}
.pcard.filled{border-color:var(--g4);}
.pcard.active{border-color:var(--g3);box-shadow:0 0 0 3px rgba(90,158,112,.18);}
.pcard-inner{display:flex;align-items:center;min-height:68px;}
.pcard-avatar{width:44px;height:68px;display:flex;align-items:center;justify-content:center;border-radius:calc(var(--r) - 2px) 0 0 calc(var(--r) - 2px);flex-shrink:0;}
.pcard.filled .pcard-avatar,.pcard.active .pcard-avatar{background:var(--g7);}
.avatar-circle{width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;font-family:'Barlow Condensed',sans-serif;}
.avatar-empty{background:var(--bdr);color:var(--ink4);}
.avatar-filled{background:rgba(255,255,255,.15);color:rgba(255,255,255,.7);}
.pcard-info{flex:1;padding:0 10px;}
.pcard-name-row{display:flex;align-items:center;gap:6px;flex-wrap:wrap;}
.pcard-name{font-size:14px;font-weight:700;color:var(--ink);}
.pcard.filled .pcard-name,.pcard.active .pcard-name{color:var(--g7);}
.tee-badge{display:inline-flex;align-items:center;gap:3px;padding:1px 6px;border-radius:99px;font-size:10px;font-weight:700;}
.tee-badge.white{background:#f0f0f0;border:1px solid #ccc;color:#555;}
.tee-badge.red{background:#fdeaea;border:1px solid #e09090;color:#aa2222;}
.tee-dot{width:7px;height:7px;border-radius:50%;display:inline-block;flex-shrink:0;}
.tee-dot.white{background:#ffffff;border:1px solid #bbb;}
.tee-dot.red{background:#cc3333;}
.pcard-sub{font-size:11px;color:var(--ink3);margin-top:2px;display:flex;align-items:center;gap:6px;}
.pcard-total{font-size:12px;color:var(--ink2);margin-top:3px;}
.score-badge{font-size:10px;padding:1px 6px;border-radius:4px;font-weight:700;}
.score-badge.e{background:#b5e6c9;color:#0c5028;}.score-badge.b{background:#d8f0e3;color:#1a6b35;}
.score-badge.p{background:#f0f0f0;color:#555;}.score-badge.bo{background:#fff2dc;color:#8a4e00;}
.score-badge.do{background:#ffe4e4;color:#991111;}.score-badge.tr{background:#f5cccc;color:#771010;}

.stepper{display:flex;align-items:center;padding-right:4px;flex-shrink:0;}
.step-btn{width:44px;height:60px;border:none;background:none;font-size:26px;cursor:pointer;display:flex;align-items:center;justify-content:center;border-radius:var(--r2);color:var(--ink3);touch-action:manipulation;}
.step-btn:active{background:var(--bg);transform:scale(.9);}
.step-val{width:50px;text-align:center;font-family:'Barlow Condensed',monospace;font-size:42px;font-weight:700;color:var(--ink);line-height:1;position:relative;cursor:text;}
.step-val.eagle{color:#0c5028;}.step-val.birdie{color:#1a6b35;}.step-val.bogey{color:#8a4e00;}
.step-val.double{color:#991111;}.step-val.triple{color:#771010;}.step-val.empty,.step-val.par{color:var(--ink);}
.step-hidden{position:absolute;inset:0;opacity:0;width:100%;height:100%;}
.swipe-hint{text-align:center;font-size:11px;color:var(--ink4);padding:4px 0 2px;}

.bottom-bar{position:sticky;bottom:0;background:var(--white);border-top:1px solid var(--bdr);padding:10px 12px;z-index:50;}
.score-summary{display:flex;gap:6px;margin-bottom:8px;overflow-x:auto;}
.summary-cell{background:var(--bg2);border:1px solid var(--bdr);border-radius:var(--r3);padding:7px 5px;text-align:center;cursor:pointer;min-width:0;flex:1;}
.summary-cell.hl{background:var(--g8);border-color:var(--g6);}
.summary-name{font-size:9px;font-weight:700;color:var(--ink3);margin-bottom:2px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.summary-cell.hl .summary-name{color:rgba(255,255,255,.4);}
.summary-score{font-family:'Barlow Condensed',sans-serif;font-size:22px;font-weight:700;color:var(--ink);line-height:1;}
.summary-cell.hl .summary-score{color:var(--gold2);}
.summary-total{font-size:9px;color:var(--ink4);margin-top:1px;}
.summary-cell.hl .summary-total{color:rgba(255,255,255,.35);}
.summary-legend{font-size:9px;color:var(--ink4);text-align:right;margin-top:-4px;margin-bottom:4px;}
.btns{display:flex;gap:8px;}
.btn-card{width:50px;height:50px;background:var(--bg2);border:1.5px solid var(--bdr);border-radius:var(--r2);font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.btn-next{flex:1;height:50px;background:var(--g5);color:white;border:none;border-radius:var(--r2);font-size:14px;font-weight:700;cursor:pointer;font-family:'Noto Sans JP',sans-serif;}
.btn-next.final{background:var(--gold);color:var(--g9);}

.sheet-overlay{position:fixed;inset:0;background:rgba(0,0,0,.55);z-index:200;display:flex;align-items:flex-end;}
.sheet{background:var(--white);border-radius:var(--r) var(--r) 0 0;width:100%;max-height:90svh;overflow-y:auto;}
.sheet-handle{width:36px;height:4px;background:var(--bdr);border-radius:99px;margin:12px auto 14px;}
.sheet-title{font-family:'Barlow Condensed',sans-serif;font-size:20px;font-weight:700;color:var(--g7);padding:0 20px 12px;border-bottom:1px solid var(--bdr);}
.sc-wrap{overflow-x:auto;}
.sc-table{width:100%;border-collapse:collapse;font-size:12px;}
.sc-table th{background:var(--g8);color:rgba(255,255,255,.6);font-size:10px;font-weight:700;padding:7px 4px;text-align:center;white-space:nowrap;}
.sc-table th.nl{text-align:left;padding-left:12px;}
.sc-table td{padding:8px 4px;text-align:center;font-family:'DM Mono',monospace;border-bottom:1px solid #f0ece4;white-space:nowrap;}
.sc-table td.nl{text-align:left;font-family:'Noto Sans JP',sans-serif;font-weight:600;font-size:11px;padding-left:12px;}
.sc-table td.tot{font-weight:700;background:rgba(45,97,71,.07);}
.sc-table td.net{font-weight:700;color:var(--g5);background:var(--gold3);}
.sc-table td.eagle{background:#b5e6c9;color:#0c5028;}.sc-table td.birdie{background:#d8f0e3;color:#1a6b35;}
.sc-table td.bogey{background:#fff2dc;color:#8a4e00;}.sc-table td.double{background:#ffe4e4;color:#991111;}
.sc-table td.triple{background:#f5cccc;color:#771010;}
.sheet-footer{padding:14px;display:flex;gap:8px;}
.btn-close{flex:1;padding:12px;background:var(--bg2);border:1.5px solid var(--bdr);border-radius:var(--r2);font-size:14px;font-weight:700;cursor:pointer;font-family:'Noto Sans JP',sans-serif;}
.btn-confirm{flex:1;padding:12px;background:var(--gold);color:var(--g9);border:none;border-radius:var(--r2);font-size:14px;font-weight:700;cursor:pointer;font-family:'Noto Sans JP',sans-serif;}

.setup-screen{padding:20px 14px;display:flex;flex-direction:column;gap:18px;}
.setup-title{font-family:'Barlow Condensed',sans-serif;font-size:24px;font-weight:700;color:var(--g7);}
.setup-sub{font-size:13px;color:var(--ink3);margin-top:3px;line-height:1.6;}
.setup-section{background:var(--bg2);border:1px solid var(--bdr);border-radius:var(--r);padding:14px;}
.setup-sec-title{font-size:11px;font-weight:700;color:var(--ink3);text-transform:uppercase;letter-spacing:1px;margin-bottom:12px;}
.tee-row{display:flex;align-items:center;gap:10px;padding:9px 0;border-bottom:1px solid var(--bdr);}
.tee-row:last-child{border-bottom:none;}
.tee-avatar{width:30px;height:30px;border-radius:50%;background:var(--g6);color:white;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;flex-shrink:0;}
.tee-name-block{flex:1;}
.tee-name{font-size:14px;font-weight:700;}
.tee-gender{font-size:11px;color:var(--ink3);margin-top:1px;}
.tee-toggle{display:flex;align-items:center;gap:6px;padding:6px 12px;border-radius:99px;border:2px solid;cursor:pointer;font-family:'Noto Sans JP',sans-serif;background:none;}
.tee-toggle.white{border-color:#ccc;background:#f8f8f8;}
.tee-toggle.red{border-color:#e09090;background:#fdeaea;}
.tee-toggle-dot{width:12px;height:12px;border-radius:50%;flex-shrink:0;}
.tee-toggle-dot.white{background:#fff;border:2px solid #bbb;}
.tee-toggle-dot.red{background:#cc3333;}
.tee-toggle-label{font-size:13px;font-weight:700;}
.tee-toggle.white .tee-toggle-label{color:#444;}
.tee-toggle.red .tee-toggle-label{color:#aa2222;}
.hole-picker{display:grid;grid-template-columns:repeat(6,1fr);gap:8px;}
.hole-pick-btn{aspect-ratio:1;border-radius:var(--r3);border:2px solid var(--bdr);background:var(--white);font-family:'DM Mono',monospace;font-size:15px;font-weight:700;color:var(--ink2);cursor:pointer;display:flex;align-items:center;justify-content:center;}
.hole-pick-btn.in-start{border-color:var(--g4);color:var(--g5);}
.hole-pick-btn:active{transform:scale(.92);}
.info-row{display:flex;align-items:center;gap:10px;background:var(--gold3);border:1px solid var(--gold);border-radius:var(--r2);padding:12px 14px;font-size:12px;color:var(--g7);line-height:1.6;}
.confirm-screen{padding:20px 14px;}
.confirm-title{font-family:'Barlow Condensed',sans-serif;font-size:24px;font-weight:700;color:var(--g7);margin-bottom:4px;}
.confirm-sub{font-size:13px;color:var(--ink3);margin-bottom:16px;}
.warn-box{background:#fff4e0;border:1px solid #e8a830;border-radius:var(--r2);padding:11px 14px;font-size:12px;color:#7a4800;margin-bottom:14px;line-height:1.6;}
.confirm-btns{display:flex;gap:8px;}
.btn-back2{padding:12px 16px;background:var(--bg2);border:1.5px solid var(--bdr);border-radius:var(--r2);font-size:13px;font-weight:700;cursor:pointer;font-family:'Noto Sans JP',sans-serif;}
.btn-send{flex:1;padding:14px;background:var(--gold);color:var(--g9);border:none;border-radius:var(--r2);font-size:15px;font-weight:700;cursor:pointer;font-family:'Noto Sans JP',sans-serif;}
.success-screen{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:60svh;padding:32px 24px;text-align:center;}
.success-ico{font-size:68px;margin-bottom:18px;}
.success-title{font-family:'Barlow Condensed',sans-serif;font-size:30px;font-weight:700;color:var(--g6);margin-bottom:8px;}
.success-sub{font-size:14px;color:var(--ink3);line-height:1.8;}
.primary-btn{width:100%;padding:14px;background:var(--g5);color:white;border:none;border-radius:var(--r2);font-size:15px;font-weight:700;cursor:pointer;font-family:'Noto Sans JP',sans-serif;}
.primary-btn:active{opacity:.85;}
.primary-btn.gold{background:var(--gold);color:var(--g9);}
.primary-btn:disabled{opacity:.4;}
.autosave{display:flex;align-items:center;gap:5px;font-size:11px;color:rgba(255,255,255,.35);}
.autosave-dot{width:6px;height:6px;border-radius:50%;background:#4caf78;}
.autosave-dot.pend{background:#d07820;animation:blink .7s infinite;}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}
@keyframes fadeIn{from{opacity:0;transform:translateY(-6px)}to{opacity:1;transform:translateY(0)}}
.toast{position:fixed;top:60px;left:50%;transform:translateX(-50%);background:var(--g8);color:white;padding:10px 20px;border-radius:var(--r2);font-size:13px;z-index:300;box-shadow:0 4px 20px rgba(0,0,0,.3);animation:fadeIn .2s;border:1px solid rgba(200,164,74,.3);}
@keyframes spin{to{transform:rotate(360deg)}}
.spinner{display:inline-block;width:16px;height:16px;border:2px solid var(--bdr);border-top-color:var(--g5);border-radius:50%;animation:spin .6s linear infinite;}
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect, useRef } = React;


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DJGA Tournament v8 â€” HCæ–¹å¼é¸æŠå¯¾å¿œï¼ˆæ–°ãƒšãƒªã‚¢ / å›ºå®šHCï¼‰
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const DEFAULTS = {
  courseName: "Watters Creek", location: "Plano, TX",
  par:   [4,4,3,5,4,4,5,4,3, 4,3,4,4,5,4,3,4,5],
  white: [392,298,126,454,386,370,471,376,151, 330,150,331,375,503,343,184,440,532],
  red:   [306,192,95,351,308,279,337,292,121,  249,123,290,308,466,288,133,369,472],
  hidden:[1,2,4,6,8,10,11,12,14,15,16,17], maxHC: 36,
  hcMode: "newPeria", // "newPeria" or "fixed"
  dragon: [6,13],       // ãƒ‰ãƒ©ã‚³ãƒ³ãƒ›ãƒ¼ãƒ«ï¼ˆH7, H14ï¼‰
  nearpin: [2,8,10,15], // ãƒ‹ã‚¢ãƒ”ãƒ³ãƒ›ãƒ¼ãƒ«ï¼ˆH3, H9, H11, H16ï¼‰
};

// â”€â”€ GAS URL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// â†“â†“â†“ ã“ã“ã«GAS URLã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ â†“â†“â†“
const GAS_URL = "YOUR_GAS_URL_HERE";
// â†‘â†‘â†‘ ä¾‹: "https://script.google.com/macros/s/AKfycbx.../exec" â†‘â†‘â†‘

async function loadGasUrl() {
  try { return localStorage.getItem("djga-gas-url") || GAS_URL; } catch { return GAS_URL; }
}
async function saveGasUrl(url) {
  try { localStorage.setItem("djga-gas-url", url); } catch {}
}

// â”€â”€ GAS API Layer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const API = {
  url: "",

  async get(action, params = {}) {
    const qs = new URLSearchParams({ action, ...params }).toString();
    const res = await fetch(`${this.url}?${qs}`, { redirect: "follow" });
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    return res.json();
  },

  async post(body) {
    const res = await fetch(this.url, {
      method: "POST",
      headers: { "Content-Type": "text/plain" }, // avoid CORS preflight
      body: JSON.stringify(body),
      redirect: "follow",
    });
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    return res.json();
  },

  async ping() {
    const r = await this.get("ping");
    return r && r.ok;
  },

  async getConfig() {
    const r = await this.get("getConfig");
    return r?.ok ? r.config : null;
  },
  async saveConfig(config) {
    return this.post({ action: "saveConfig", config });
  },

  async getGroups() {
    const r = await this.get("getGroups");
    return r?.ok ? r.groups : {};
  },
  async saveGroups(groups) {
    return this.post({ action: "saveGroups", groups });
  },

  async getScores(groupNum) {
    const r = await this.get("getScores", { group: groupNum });
    return r?.ok ? r.data : null;
  },
  async saveScores(groupNum, members, scores, hcMode) {
    return this.post({ action: "saveScores", groupNum, members, scores, hcMode });
  },
  async getAllScores() {
    const r = await this.get("getAllScores");
    return r?.ok ? r.data : [];
  },
  async clearAll() {
    return this.post({ action: "clearAll" });
  },
};


function QRImage({ data, size=200 }) {
  return <img src={`https://api.qrserver.com/v1/create-qr-code/?size=${size}x${size}&data=${encodeURIComponent(data)}&margin=8&color=163824&bgcolor=f2ede3`}
    alt="QR" width={size} height={size} style={{borderRadius:12,border:"3px solid #e2ddd2"}} onError={e=>{e.target.style.display="none";}} />;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MAIN APP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function App() {
  const [page, setPage]       = useState("home");
  const [gasUrl, setGasUrl]   = useState("");
  const [connected, setConn]  = useState(false);
  const [config, setConfig]   = useState({ ...DEFAULTS });
  const [groups, setGroups]   = useState({});
  const [selGroup, setSel]    = useState(null);
  const [loading, setLoading] = useState(true);
  const [toast, setToast]     = useState("");

  const showToast = m => { setToast(m); setTimeout(()=>setToast(""),2500); };

  // Init: load GAS URL from localStorage
  useEffect(() => {
    (async () => {
      const url = await loadGasUrl();
      if (url) {
        setGasUrl(url);
        API.url = url;
        try {
          const ok = await API.ping();
          if (ok) {
            setConn(true);
            const [cfg, grp] = await Promise.all([API.getConfig(), API.getGroups()]);
            if (cfg?.courseName) setConfig(cfg);
            if (grp) setGroups(grp);
          }
        } catch {}
      }
      setLoading(false);
    })();
  }, []);

  const connectGas = async (url) => {
    API.url = url;
    try {
      const ok = await API.ping();
      if (ok) {
        setGasUrl(url); setConn(true);
        await saveGasUrl(url);
        const [cfg, grp] = await Promise.all([API.getConfig(), API.getGroups()]);
        if (cfg?.courseName) setConfig(cfg);
        if (grp) setGroups(grp);
        showToast("âœ… Spreadsheetã«æ¥ç¶šã—ã¾ã—ãŸ");
        return true;
      }
    } catch {}
    showToast("âŒ æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸã€‚URLã‚’ç¢ºèªã—ã¦ãã ã•ã„");
    return false;
  };

  const coursePar = config.par?.reduce((a,b)=>a+b,0) || 72;

  if (loading) return (<><div className="app" style={{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"100svh"}}><div className="spinner" style={{width:28,height:28}} /></div></>);

  return (
    <>
    <div className="app">
      {toast && <div className="toast">{toast}</div>}
      {page==="home" && <HomePage setPage={setPage} groups={groups} setGroups={setGroups} config={config} setConfig={setConfig} coursePar={coursePar} connected={connected} showToast={showToast} />}
      {page==="config" && <ConfigPage config={config} setConfig={setConfig} gasUrl={gasUrl} connected={connected} connectGas={connectGas} showToast={showToast} setPage={setPage} />}
      {page==="groups" && <GroupListPage groups={groups} setGroups={setGroups} setSel={setSel} setPage={setPage} connected={connected} showToast={showToast} />}
      {page==="groupDetail" && <GroupDetailPage gn={selGroup} groups={groups} setGroups={setGroups} config={config} connected={connected} showToast={showToast} setPage={setPage} />}
      {page==="ranking" && <RankingPage config={config} connected={connected} setPage={setPage} />}
    </div></>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HOME
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function HomePage({ setPage, groups, setGroups, config, setConfig, coursePar, connected, showToast }) {
  const tg = Object.keys(groups).filter(k=>groups[k].length>0).length;
  const tp = Object.values(groups).flat().length;

  const clearAll = async () => {
    if(!confirm("âš ï¸ å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ\n\nãƒ»å¤§ä¼šè¨­å®šï¼ˆã‚³ãƒ¼ã‚¹åã€ãƒ‘ãƒ¼ã€éš ã—Hã€HCè¨­å®šï¼‰\nãƒ»ã‚°ãƒ«ãƒ¼ãƒ—ãƒ»ãƒ¡ãƒ³ãƒãƒ¼ç™»éŒ²\nãƒ»ã‚¹ã‚³ã‚¢ãƒ‡ãƒ¼ã‚¿\n\nã™ã¹ã¦ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚"))return;
    const d = {...DEFAULTS};
    setConfig(d);
    setGroups({});
    if(connected){
      try{ await API.clearAll(); showToast("ğŸ—‘ï¸ å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ"); }
      catch{ showToast("âŒ ã‚¯ãƒªã‚¢å¤±æ•—ã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ç¢ºèª"); }
    } else { showToast("ğŸ—‘ï¸ ãƒ­ãƒ¼ã‚«ãƒ«ã®ã¿ã‚¯ãƒªã‚¢"); }
  };

  return (<>
    <div className="topbar">
      <div className="topbar-logo">DJGA</div><div className="topbar-sep" />
      <div className="topbar-info"><strong>Tournament System</strong>{config.courseName} â€” {config.location}</div>
      <div className="topbar-space" />
      <div style={{display:"flex",alignItems:"center",gap:4}}>
        <div className="conn-dot" style={{width:8,height:8,borderRadius:"50%",background:connected?"#4caf78":"#d07820"}} />
        <span style={{fontSize:10,color:"rgba(255,255,255,.4)"}}>{connected?"æ¥ç¶šä¸­":"æœªæ¥ç¶š"}</span>
      </div>
    </div>
    <div className="home">
      <div className="home-logo">
        <div className="home-logo-icon">â›³</div>
        <div className="home-logo-text">DJGA</div>
        <div className="home-logo-sub">Dallas Japanese Golf Association</div>
      </div>
      {!connected && (
        <div className="conn-status err" style={{cursor:"pointer"}} onClick={()=>setPage("config")}>
          <div className="conn-dot" style={{background:"#c44"}} />
          Google Spreadsheetæœªæ¥ç¶š â€” å¤§ä¼šè¨­å®šã‹ã‚‰URLã‚’è¨­å®š â†’
        </div>
      )}
      {tg>0 && (
        <div style={{background:"var(--gold3)",border:"1px solid var(--gold)",borderRadius:10,padding:"10px 14px",marginBottom:16,display:"flex",justifyContent:"space-around",fontSize:13}}>
          <span><strong>{tg}</strong> ã‚°ãƒ«ãƒ¼ãƒ—</span><span><strong>{tp}</strong> å</span><span>Par {coursePar}</span>
        </div>
      )}
      <div className="home-menu">
        <button className="home-btn" onClick={()=>setPage("config")}>
          <div className="home-btn-icon icfg">âš™</div>
          <div><div className="home-btn-label">å¤§ä¼šè¨­å®š</div><div className="home-btn-desc">GASæ¥ç¶š / {config.hcMode==="fixed"?"å›ºå®šHC":"æ–°ãƒšãƒªã‚¢"} / Par {coursePar}</div></div>
          <div className="home-btn-arrow">â€º</div>
        </button>
        <button className="home-btn" onClick={()=>setPage("groups")}>
          <div className="home-btn-icon grp">ğŸ‘¥</div>
          <div><div className="home-btn-label">ã‚°ãƒ«ãƒ¼ãƒ—ç®¡ç†</div><div className="home-btn-desc">ãƒ¡ãƒ³ãƒãƒ¼ç™»éŒ²ãƒ»QRã‚³ãƒ¼ãƒ‰ç™ºè¡Œ</div></div>
          <div className="home-btn-arrow">â€º</div>
        </button>
        <button className="home-btn" onClick={()=>setPage("ranking")}>
          <div className="home-btn-icon rank">ğŸ†</div>
          <div><div className="home-btn-label">æˆç¸¾ãƒ»é †ä½è¡¨</div><div className="home-btn-desc">HC / Net / Gross ãƒ©ãƒ³ã‚­ãƒ³ã‚°</div></div>
          <div className="home-btn-arrow">â€º</div>
        </button>
      </div>
      <div style={{marginTop:24,padding:"12px 14px",background:"var(--bg2)",border:"1px solid var(--bdr)",borderRadius:10}}>
        <p style={{fontSize:11,color:"var(--ink3)",lineHeight:1.7}}>
          ğŸ’¡ <strong>é‹ç”¨ãƒ•ãƒ­ãƒ¼ï¼š</strong><br/>
          â‘  å¤§ä¼šè¨­å®šã§GAS URLæ¥ç¶šï¼‹ã‚³ãƒ¼ã‚¹è¨­å®š<br/>
          â‘¡ ã‚°ãƒ«ãƒ¼ãƒ—ç®¡ç†ã§ãƒ¡ãƒ³ãƒãƒ¼ç™»éŒ²ãƒ»QRé…å¸ƒ<br/>
          â‘¢ å½“æ—¥ï¼šQRã‹ã‚‰å„ã‚°ãƒ«ãƒ¼ãƒ—ãŒã‚¹ã‚³ã‚¢å…¥åŠ›<br/>
          â‘£ æˆç¸¾è¡¨ã§å…¨ä½“é †ä½ã‚’ç¢ºèª<br/>
          ğŸ“„ ç´™ã‚¹ã‚³ã‚¢ã‚«ãƒ¼ãƒ‰ã‚‚ä¸¦è¡Œè¨˜å…¥ï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼‰
        </p>
      </div>
      <button onClick={clearAll} style={{width:"100%",marginTop:16,padding:12,background:"none",border:"1.5px solid #e8a8a8",borderRadius:10,fontSize:13,color:"#aa3333",cursor:"pointer",fontFamily:"inherit",fontWeight:600}}>
        ğŸ—‘ï¸ æ¬¡å›å¤§ä¼šã®æº–å‚™ï¼ˆå…¨ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢ï¼‰
      </button>
    </div>
  </>);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIG PAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function ConfigPage({ config, setConfig, gasUrl, connected, connectGas, showToast, setPage }) {
  const [c, setC] = useState({ ...config });
  const [url, setUrl] = useState(gasUrl);
  const [testing, setTesting] = useState(false);
  const [saving, setSaving] = useState(false);
  const pt = c.par?.reduce((a,b)=>a+b,0)||0;

  const setPar = (i,v) => { const p=[...c.par];p[i]=v;setC({...c,par:p}); };
  const setW = (i,v) => { const w=[...c.white];w[i]=Number(v)||0;setC({...c,white:w}); };
  const setR = (i,v) => { const r=[...c.red];r[i]=Number(v)||0;setC({...c,red:r}); };
  const togH = i => {
    const h=[...c.hidden],idx=h.indexOf(i);
    if(idx>=0)h.splice(idx,1);else if(h.length<12)h.push(i);else{showToast("âš ï¸ æœ€å¤§12ãƒ›ãƒ¼ãƒ«");return;}
    h.sort((a,b)=>a-b);setC({...c,hidden:h});
  };

  const testConnect = async () => {
    if(!url.trim()){showToast("âš ï¸ URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");return;}
    setTesting(true);
    await connectGas(url.trim());
    setTesting(false);
  };

  const save = async () => {
    if(c.hcMode==="newPeria" && c.hidden.length!==12){showToast("âš ï¸ éš ã—ãƒ›ãƒ¼ãƒ«ã‚’12å€‹é¸æŠ");return;}
    if(!c.courseName?.trim()){showToast("âš ï¸ ã‚³ãƒ¼ã‚¹åã‚’å…¥åŠ›");return;}
    setSaving(true);
    setConfig(c);
    if(connected) {
      try { await API.saveConfig(c); showToast("âœ… Spreadsheetã«ä¿å­˜ã—ã¾ã—ãŸ"); }
      catch { showToast("âŒ ä¿å­˜å¤±æ•—ã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ç¢ºèª"); }
    } else { showToast("âš ï¸ ãƒ­ãƒ¼ã‚«ãƒ«ã®ã¿ä¿å­˜ï¼ˆSpreadsheetæœªæ¥ç¶šï¼‰"); }
    setSaving(false);
  };

  return (<>
    <div className="topbar">
      <button className="topbar-back" onClick={()=>setPage("home")}>â€¹</button>
      <div className="topbar-logo">DJGA</div><div className="topbar-sep" />
      <div className="topbar-info"><strong>å¤§ä¼šè¨­å®š</strong></div>
    </div>
    <div className="cfg">
      <div className="cfg-title">å¤§ä¼šè¨­å®š</div>
      <div className="cfg-sub">Google Spreadsheetæ¥ç¶šã¨ã‚³ãƒ¼ã‚¹æƒ…å ±ã‚’è¨­å®šã—ã¾ã™ã€‚</div>

      {/* GAS URL */}
      <div className="cfg-card" style={{borderColor: connected ? "#a8d8b8" : "#f0b0b0"}}>
        <div className="cfg-label">ğŸ”— Google Apps Script URL</div>
        <div className={`conn-status ${connected?"ok":"err"}`} style={{marginBottom:10}}>
          <div className="conn-dot" style={{background:connected?"#4caf78":"#c44"}} />
          {connected ? `æ¥ç¶šæ¸ˆã¿ â€” ${gasUrl.slice(0,50)}...` : "æœªæ¥ç¶š â€” URLã‚’è¨­å®šã—ã¦ãã ã•ã„"}
        </div>
        <input className="cfg-input" value={url} onChange={e=>setUrl(e.target.value)}
          placeholder="https://script.google.com/macros/s/.../exec"
          style={{fontSize:12,fontFamily:"'DM Mono',monospace",marginBottom:8}} />
        <button className="primary-btn" onClick={testConnect} disabled={testing}
          style={{background:"var(--g5)",fontSize:13,padding:10}}>
          {testing ? <><span className="spinner" style={{width:14,height:14,marginRight:6,verticalAlign:"middle"}} /> æ¥ç¶šãƒ†ã‚¹ãƒˆä¸­...</> : "ğŸ”Œ æ¥ç¶šãƒ†ã‚¹ãƒˆ"}
        </button>
        <p style={{fontSize:10,color:"var(--ink4)",marginTop:8,lineHeight:1.6}}>
          GASã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †ã¯ djga-gas-backend.js ã®å…ˆé ­ã‚³ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§
        </p>
      </div>

      {/* Course */}
      <div className="cfg-card">
        <div className="cfg-label">ğŸŒï¸ ã‚³ãƒ¼ã‚¹å</div>
        <input className="cfg-input" value={c.courseName||""} onChange={e=>setC({...c,courseName:e.target.value})} />
      </div>
      <div className="cfg-card">
        <div className="cfg-label">ğŸ“ å ´æ‰€</div>
        <input className="cfg-input" value={c.location||""} onChange={e=>setC({...c,location:e.target.value})} />
      </div>

      {/* HC Mode */}
      <div className="cfg-card" style={{borderColor: c.hcMode==="newPeria"?"var(--g4)":"var(--gold)"}}>
        <div className="cfg-label">ğŸ¯ HCæ–¹å¼</div>
        <div style={{display:"flex",gap:8,marginBottom:10}}>
          {[{k:"newPeria",l:"æ–°ãƒšãƒªã‚¢",d:"éš ã—Hã‹ã‚‰è‡ªå‹•è¨ˆç®—"},{k:"fixed",l:"å›ºå®šHC",d:"å„é¸æ‰‹ã«äº‹å‰è¨­å®š"}].map(opt=>(
            <button key={opt.k} onClick={()=>setC({...c,hcMode:opt.k})} style={{
              flex:1,padding:"12px 8px",borderRadius:10,cursor:"pointer",textAlign:"center",fontFamily:"inherit",
              border: c.hcMode===opt.k ? "2.5px solid var(--g4)" : "2px solid var(--bdr)",
              background: c.hcMode===opt.k ? "var(--g7)" : "var(--white)",
              color: c.hcMode===opt.k ? "white" : "var(--ink2)",
            }}>
              <div style={{fontSize:14,fontWeight:700,marginBottom:2}}>{opt.l}</div>
              <div style={{fontSize:10,opacity:.7}}>{opt.d}</div>
            </button>
          ))}
        </div>
        {c.hcMode==="newPeria" && <p style={{fontSize:11,color:"var(--ink4)",lineHeight:1.5}}>ğŸ“ HC = (éš ã—Håˆè¨ˆ Ã— {c.hidden.length>0?(18/c.hidden.length).toFixed(1):"?"} âˆ’ Par) Ã— 0.8</p>}
        {c.hcMode==="fixed" && <p style={{fontSize:11,color:"var(--ink4)",lineHeight:1.5}}>ğŸ‘¤ ã‚°ãƒ«ãƒ¼ãƒ—ç®¡ç†ã§å„ãƒ¡ãƒ³ãƒãƒ¼ã®HCã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>}
      </div>

      <div className="cfg-card">
        <div className="cfg-label">ğŸ”’ HCä¸Šé™</div>
        <div className="cfg-row">
          <input type="number" className="cfg-sm" value={c.maxHC} onChange={e=>setC({...c,maxHC:Math.max(0,Math.min(54,Number(e.target.value)||0))})} />
          <span style={{fontSize:13,color:"var(--ink3)"}}>ï¼ˆé€šå¸¸ 36ï¼‰</span>
        </div>
      </div>

      {/* Par */}
      <div className="cfg-card">
        <div className="cfg-label"><span>â›³ ãƒ‘ãƒ¼</span><span style={{marginLeft:"auto",color:"var(--g5)",fontWeight:700,fontSize:13}}>åˆè¨ˆ {pt}</span></div>
        {["OUTï¼ˆ1ã€œ9ï¼‰","INï¼ˆ10ã€œ18ï¼‰"].map((lbl,hi)=>(
          <div key={hi}>
            <div className="nine-label">{lbl}</div>
            <div className="par-grid">{Array.from({length:9},(_,i)=>{const idx=hi*9+i;return(
              <div key={idx} className="par-cell"><div className="par-cell-num">H{idx+1}</div>
                <select value={c.par[idx]} onChange={e=>setPar(idx,Number(e.target.value))}>
                  {[3,4,5].map(v=><option key={v} value={v}>{v}</option>)}
                </select></div>
            );})}</div>
          </div>
        ))}
      </div>

      {/* Yards */}
      <div className="cfg-card">
        <div className="cfg-label">ğŸ“ ãƒ¤ãƒ¼ãƒ‰ï¼ˆä»»æ„ï¼‰</div>
        {["OUTï¼ˆ1ã€œ9ï¼‰","INï¼ˆ10ã€œ18ï¼‰"].map((lbl,hi)=>(
          <div key={hi}>
            <div className="nine-label">{lbl}</div>
            <div className="par-grid">{Array.from({length:9},(_,i)=>{const idx=hi*9+i;return(
              <div key={idx} className="par-cell">
                <div className="par-cell-num" style={{display:"flex",gap:2,alignItems:"center"}}>
                  <span style={{width:5,height:5,borderRadius:"50%",background:"#fff",border:"1px solid #bbb",display:"inline-block"}} />W
                </div>
                <input type="number" value={c.white[idx]||""} onChange={e=>setW(idx,e.target.value)} placeholder="â€”" />
              </div>
            );})}</div>
            <div style={{height:2}} />
            <div className="par-grid">{Array.from({length:9},(_,i)=>{const idx=hi*9+i;return(
              <div key={idx} className="par-cell">
                <div className="par-cell-num" style={{display:"flex",gap:2,alignItems:"center"}}>
                  <span style={{width:5,height:5,borderRadius:"50%",background:"#c33",display:"inline-block"}} />R
                </div>
                <input type="number" value={c.red[idx]||""} onChange={e=>setR(idx,e.target.value)} placeholder="â€”" />
              </div>
            );})}</div>
          </div>
        ))}
      </div>

      {/* Hidden (æ–°ãƒšãƒªã‚¢ only) */}
      {c.hcMode==="newPeria" && (
      <div className="cfg-card">
        <div className="cfg-label"><span>ğŸ² éš ã—ãƒ›ãƒ¼ãƒ«</span>
          <span style={{marginLeft:"auto",fontWeight:700,fontSize:13,color:c.hidden.length===12?"var(--g5)":"#c44"}}>{c.hidden.length}/12</span>
        </div>
        <p style={{fontSize:11,color:"var(--ink4)",marginBottom:10}}>ã‚¿ãƒƒãƒ—ã§12ãƒ›ãƒ¼ãƒ«é¸æŠï¼ˆé¸æ‰‹ã«ã¯éå…¬é–‹ï¼‰</p>
        {["OUTï¼ˆ1ã€œ9ï¼‰","INï¼ˆ10ã€œ18ï¼‰"].map((lbl,hi)=>(
          <div key={hi}>
            <div className="nine-label">{lbl}</div>
            <div className="hidden-grid">{Array.from({length:9},(_,i)=>{const idx=hi*9+i;return(
              <button key={idx} className={"hidden-btn"+(c.hidden.includes(idx)?" on":"")} onClick={()=>togH(idx)}>
                {idx+1}<span className="hidden-par">P{c.par[idx]}</span>
              </button>
            );})}</div>
          </div>
        ))}
      </div>
      )}

      {/* ãƒ‰ãƒ©ã‚³ãƒ³ãƒ»ãƒ‹ã‚¢ãƒ”ãƒ³ */}
      <div className="cfg-card">
        <div className="cfg-label">ğŸ† ãƒ‰ãƒ©ã‚³ãƒ³ãƒ»ãƒ‹ã‚¢ãƒ”ãƒ³</div>
        <p style={{fontSize:11,color:"var(--ink4)",marginBottom:10}}>ã‚¿ãƒƒãƒ—ã§é¸æŠï¼ˆã‚¹ã‚³ã‚¢å…¥åŠ›ç”»é¢ã«ãƒãƒƒã‚¸è¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰</p>

        <div style={{fontSize:12,fontWeight:700,color:"var(--g7)",marginBottom:6}}>ğŸš€ ãƒ‰ãƒ©ã‚³ãƒ³ï¼ˆ{(c.dragon||[]).length}ãƒ›ãƒ¼ãƒ«ï¼‰</div>
        <div className="hidden-grid" style={{marginBottom:12}}>
          {Array.from({length:18},(_,i)=>(
            <button key={i} className={"hidden-btn"+((c.dragon||[]).includes(i)?" on":"")}
              style={(c.dragon||[]).includes(i)?{borderColor:"#C62828",background:"#FFEBEE",color:"#C62828"}:{}}
              onClick={()=>{
                const d=[...(c.dragon||[])],idx=d.indexOf(i);
                if(idx>=0)d.splice(idx,1);else d.push(i);
                d.sort((a,b)=>a-b);setC({...c,dragon:d});
              }}>
              {i+1}<span className="hidden-par">P{c.par[i]}</span>
            </button>
          ))}
        </div>

        <div style={{fontSize:12,fontWeight:700,color:"var(--g7)",marginBottom:6}}>ğŸ¯ ãƒ‹ã‚¢ãƒ”ãƒ³ï¼ˆ{(c.nearpin||[]).length}ãƒ›ãƒ¼ãƒ«ï¼‰</div>
        <div className="hidden-grid">
          {Array.from({length:18},(_,i)=>(
            <button key={i} className={"hidden-btn"+((c.nearpin||[]).includes(i)?" on":"")}
              style={(c.nearpin||[]).includes(i)?{borderColor:"#1565C0",background:"#E3F2FD",color:"#1565C0"}:{}}
              onClick={()=>{
                const n=[...(c.nearpin||[])],idx=n.indexOf(i);
                if(idx>=0)n.splice(idx,1);else n.push(i);
                n.sort((a,b)=>a-b);setC({...c,nearpin:n});
              }}>
              {i+1}<span className="hidden-par">P{c.par[i]}</span>
            </button>
          ))}
        </div>
      </div>

      <div className="info-row" style={{marginBottom:12}}>
        <span style={{fontSize:18}}>ğŸ“‹</span>
        <div style={{fontSize:12,lineHeight:1.6}}>
          <strong>{c.courseName}</strong>ï¼ˆ{c.location}ï¼‰<br/>
          Par {pt} / HCæ–¹å¼: {c.hcMode==="fixed"?"å›ºå®šHC":"æ–°ãƒšãƒªã‚¢"}{c.hcMode==="newPeria"?` / éš ã—${c.hidden.length}H`:""} / HCä¸Šé™ {c.maxHC}
        </div>
      </div>

      <button className="primary-btn gold" onClick={save} disabled={saving||(c.hcMode==="newPeria"&&c.hidden.length!==12)}>
        {saving?"ä¿å­˜ä¸­...":"ğŸ’¾ è¨­å®šã‚’ä¿å­˜"}
      </button>
    </div>
  </>);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GROUP LIST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function GroupListPage({ groups, setGroups, setSel, setPage, connected, showToast }) {
  const totalMembers = Object.values(groups).flat().length;
  const totalGroups = Object.keys(groups).filter(k=>groups[k].length>0).length;

  const clearAll = async () => {
    if(!confirm("å…¨ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ\n\nãƒ»å…¨ã‚°ãƒ«ãƒ¼ãƒ—ãƒ»å…¨ãƒ¡ãƒ³ãƒãƒ¼ãŒå‰Šé™¤ã•ã‚Œã¾ã™\nãƒ»å¤§ä¼šè¨­å®šã‚„ã‚¹ã‚³ã‚¢ãƒ‡ãƒ¼ã‚¿ã«ã¯å½±éŸ¿ã—ã¾ã›ã‚“"))return;
    setGroups({});
    if(connected){
      try{await API.saveGroups({});showToast("ğŸ—‘ï¸ å…¨ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ");}
      catch{showToast("âŒ ã‚¯ãƒªã‚¢å¤±æ•—");}
    } else { showToast("ğŸ—‘ï¸ ãƒ­ãƒ¼ã‚«ãƒ«ã®ã¿ã‚¯ãƒªã‚¢"); }
  };

  return (<>
    <div className="topbar"><button className="topbar-back" onClick={()=>setPage("home")}>â€¹</button>
      <div className="topbar-logo">DJGA</div><div className="topbar-sep" /><div className="topbar-info"><strong>ã‚°ãƒ«ãƒ¼ãƒ—ç®¡ç†</strong></div></div>
    <div className="gm">
      <div className="gm-title">ã‚°ãƒ«ãƒ¼ãƒ—ä¸€è¦§</div>
      <div className="gm-sub">ç•ªå·ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ãƒ¡ãƒ³ãƒãƒ¼ç™»éŒ²ãƒ»QRã‚³ãƒ¼ãƒ‰ç™ºè¡Œã€‚</div>
      <div className="gm-grid">{Array.from({length:20},(_,i)=>{const n=String(i+1),m=groups[n]||[];return(
        <button key={n} className={"gm-num"+(m.length>0?" has":"")} onClick={()=>{setSel(n);setPage("groupDetail");}}>
          {n}{m.length>0&&<span className="gm-count">{m.length}å</span>}
        </button>);})}</div>

      {totalGroups > 0 && (
        <div style={{marginTop:8,padding:"10px 14px",background:"var(--bg2)",border:"1px solid var(--bdr)",borderRadius:10,display:"flex",justifyContent:"space-between",alignItems:"center"}}>
          <span style={{fontSize:12,color:"var(--ink3)"}}>{totalGroups}ã‚°ãƒ«ãƒ¼ãƒ— / {totalMembers}åç™»éŒ²æ¸ˆã¿</span>
          <button onClick={clearAll} style={{padding:"6px 14px",background:"none",border:"1.5px solid #e8a8a8",borderRadius:8,fontSize:12,color:"#aa3333",cursor:"pointer",fontFamily:"inherit",fontWeight:600}}>
            ğŸ—‘ï¸ å…¨ã‚¯ãƒªã‚¢
          </button>
        </div>
      )}
    </div>
  </>);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GROUP DETAIL + QR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function GroupDetailPage({ gn, groups, setGroups, config, connected, showToast, setPage }) {
  const members = groups[gn]||[];
  const [nn, setNn] = useState(""); const [nt, setNt] = useState("white"); const [nh, setNh] = useState("");
  const [copied, setCopied] = useState(false); const [saving, setSaving] = useState(false);

  const saveToGAS = async (updated) => {
    setGroups(updated);
    if (connected) {
      setSaving(true);
      try { await API.saveGroups(updated); } catch { showToast("âš ï¸ Spreadsheetä¿å­˜å¤±æ•—"); }
      setSaving(false);
    }
  };

  const add = () => {
    const name=nn.trim(); if(!name)return; if(members.length>=6){showToast("âš ï¸ æœ€å¤§6å");return;}
    const hcVal = nh==="" ? "" : Math.max(-54, Math.min(54, Number(nh)||0));
    saveToGAS({...groups,[gn]:[...members,{name,tee:nt,fixedHC:hcVal}]});
    setNn(""); setNh(""); showToast(`âœ… ${name} ã‚’è¿½åŠ `);
  };
  const del = idx => saveToGAS({...groups,[gn]:members.filter((_,i)=>i!==idx)});
  const togTee = idx => saveToGAS({...groups,[gn]:members.map((m,i)=>i===idx?{...m,tee:m.tee==="white"?"red":"white"}:m)});
  const setFixedHC = (idx, val) => {
    // å…¥åŠ›ä¸­ã¯ç”Ÿå€¤ã‚’ä¿æŒï¼ˆ"-" ã‚„ "-1" ã®é€”ä¸­å…¥åŠ›ã‚’è¨±å¯ï¼‰
    saveToGAS({...groups,[gn]:members.map((m,i)=>i===idx?{...m,fixedHC:val}:m)});
  };
  const blurFixedHC = (idx, val) => {
    const v = val===""||val==="-" ? "" : Math.max(-54, Math.min(54, Number(val)||0));
    saveToGAS({...groups,[gn]:members.map((m,i)=>i===idx?{...m,fixedHC:v}:m)});
  };

  const base = window.location.href.split("?")[0].split("#")[0];
  const scoreUrl = base.replace(/index\.html$/, "") + "score.html";
  const gasParam = API.url ? `&gas=${encodeURIComponent(API.url)}` : "";
  const qrData = `${scoreUrl}?group=${gn}${gasParam}`;
  const copyLink = () => { navigator.clipboard.writeText(qrData).catch(()=>{}); setCopied(true);setTimeout(()=>setCopied(false),2000);showToast("ğŸ“‹ ã‚³ãƒ”ãƒ¼"); };

  return (<>
    <div className="topbar"><button className="topbar-back" onClick={()=>setPage("groups")}>â€¹</button>
      <div className="topbar-logo">DJGA</div><div className="topbar-sep" />
      <div className="topbar-info"><strong>{gn}çµ„</strong>{config.courseName}</div>
      <div className="topbar-space" />
      {saving && <span className="spinner" style={{width:14,height:14}} />}
    </div>
    <div className="gd">
      <div className="gd-header">
        <div className="gd-num">{gn}</div>
        <div><div className="gd-title">{gn}çµ„</div><div className="gd-subtitle">{members.length}åç™»éŒ²</div></div>
      </div>
      <div className="gd-section">
        <div className="gd-sec-title"><span>ğŸ‘¤</span> ãƒ¡ãƒ³ãƒãƒ¼ <span style={{marginLeft:"auto",fontSize:11,fontWeight:400,color:"var(--ink4)"}}>{members.length}/6</span></div>
        {members.length===0&&<p style={{fontSize:13,color:"var(--ink4)",textAlign:"center",padding:"16px 0"}}>ãƒ¡ãƒ³ãƒãƒ¼ã‚’è¿½åŠ ã—ã¦ãã ã•ã„</p>}
        {members.map((m,i)=>(
          <div key={i} className="member-row" style={{flexWrap: config.hcMode==="fixed"?"wrap":"nowrap"}}>
            <div className="member-avatar">{m.name[0]}</div>
            <div className="member-name">{m.name}</div>
            <button className={"member-tee "+m.tee} onClick={()=>togTee(i)}>
              <span className={"tee-dot "+m.tee} style={{display:"inline-block",width:8,height:8,borderRadius:"50%",marginRight:4}} />{m.tee==="white"?"White":"Red"}
            </button>
            {config.hcMode==="fixed" && (
              <div style={{display:"flex",alignItems:"center",gap:4}}>
                <span style={{fontSize:11,color:"var(--ink3)",fontWeight:700}}>HC</span>
                <input type="number" inputMode="numeric" value={m.fixedHC===""||m.fixedHC===undefined?"":m.fixedHC}
                  onChange={e=>setFixedHC(i,e.target.value)}
                  onBlur={e=>blurFixedHC(i,e.target.value)}
                  style={{width:48,padding:"4px 6px",border:"2px solid var(--bdr)",borderRadius:6,fontSize:14,fontWeight:700,textAlign:"center",fontFamily:"'DM Mono',monospace",background:"var(--white)",outline:"none"}}
                  onFocus={e=>e.target.select()} placeholder="â€”" />
              </div>
            )}
            <button className="member-del" onClick={()=>del(i)}>Ã—</button>
          </div>
        ))}
        <div className="add-row" style={{flexWrap: config.hcMode==="fixed"?"wrap":"nowrap"}}>
          <input className="add-input" value={nn} onChange={e=>setNn(e.target.value)} placeholder="é¸æ‰‹å" onKeyDown={e=>e.key==="Enter"&&add()} style={{minWidth:0}} />
          <button className={"tee-toggle "+nt} onClick={()=>setNt(nt==="white"?"red":"white")} style={{flexShrink:0,padding:"6px 10px"}}>
            <span className={"tee-toggle-dot "+nt} /><span className="tee-toggle-label">{nt==="white"?"W":"R"}</span>
          </button>
          {config.hcMode==="fixed" && (
            <div style={{display:"flex",alignItems:"center",gap:4,flexShrink:0}}>
              <span style={{fontSize:11,color:"var(--ink3)",fontWeight:700}}>HC</span>
              <input type="number" inputMode="numeric" value={nh} onChange={e=>setNh(e.target.value)}
                style={{width:48,padding:"4px 6px",border:"2px solid var(--bdr)",borderRadius:6,fontSize:14,fontWeight:700,textAlign:"center",fontFamily:"'DM Mono',monospace",background:"var(--white)",outline:"none"}}
                onFocus={e=>e.target.select()} placeholder="â€”" onKeyDown={e=>e.key==="Enter"&&add()} />
            </div>
          )}
          <button className="add-btn" onClick={add} disabled={!nn.trim()}>è¿½åŠ </button>
        </div>
      </div>
      {members.length>0&&(<>
        <div className="qr-section">
          <div className="qr-title">ğŸ“± {gn}çµ„ ã‚¹ã‚³ã‚¢å…¥åŠ›ãƒªãƒ³ã‚¯</div>
          <div className="qr-sub">QRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚³ã‚¢å…¥åŠ›ä¿‚ã«ã‚¹ã‚­ãƒ£ãƒ³ã—ã¦ã‚‚ã‚‰ã£ã¦ãã ã•ã„</div>
          <div className="qr-img-wrap"><QRImage data={qrData} size={200} /></div>
          <div style={{background:"var(--g8)",color:"white",borderRadius:8,padding:"10px 14px",marginBottom:12,fontSize:13,fontWeight:600,display:"flex",alignItems:"center",justifyContent:"center",gap:8}}>
            ğŸŒï¸ {gn}çµ„ â€” {members.map(m=>m.name).join("ã€")}
          </div>
          <div className="qr-link-box">
            <div className="qr-link-text">{qrData}</div>
            <button className={"qr-copy-btn"+(copied?" copied":"")} onClick={copyLink}>{copied?"âœ“":"ã‚³ãƒ”ãƒ¼"}</button>
          </div>
          <div className="qr-hint">ğŸ“Œ ãƒ¡ãƒ³ãƒãƒ¼æƒ…å ±ã¯Spreadsheetã‹ã‚‰è‡ªå‹•å–å¾—ã•ã‚Œã¾ã™ã€‚</div>
        </div>
      </>)}
    </div>
  </>);
}


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RANKING PAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function RankingPage({ config, connected, setPage }) {
  const [data, setData] = useState(null); const [loading, setLoading] = useState(true);
  const [sort, setSort] = useState("net");

  useEffect(() => {
    (async () => {
      if (connected) {
        try { const d = await API.getAllScores(); setData(d); } catch { setData([]); }
      } else { setData([]); }
      setLoading(false);
    })();
  }, [connected]);

  const sorted = (data||[]).filter(r=>r.gross>0).sort((a,b) => sort==="net"?(a.net-b.net):(a.gross-b.gross));
  const medals = ["ğŸ¥‡","ğŸ¥ˆ","ğŸ¥‰"];
  const cp = config.par?.reduce((a,b)=>a+b,0)||72;

  return (<>
    <div className="topbar"><button className="topbar-back" onClick={()=>setPage("home")}>â€¹</button>
      <div className="topbar-logo">DJGA</div><div className="topbar-sep" /><div className="topbar-info"><strong>æˆç¸¾ãƒ»é †ä½è¡¨</strong></div></div>
    <div className="gm">
      <div className="gm-title">ğŸ† æˆç¸¾ãƒ»é †ä½è¡¨</div>
      <div style={{display:"flex",gap:6,marginBottom:12,fontSize:12,color:"var(--ink3)",flexWrap:"wrap"}}>
        <span>{config.hcMode==="fixed"?"å›ºå®šHCæ–¹å¼":"æ–°ãƒšãƒªã‚¢æ–¹å¼"}</span><span>Par {cp}</span><span>HCä¸Šé™ {config.maxHC}</span>
      </div>

      <div style={{display:"flex",gap:8,marginBottom:16}}>
        {[{k:"net",l:"Neté †ä½"},{k:"gross",l:"Grossé †ä½"}].map(s=>(
          <button key={s.k} onClick={()=>setSort(s.k)} style={{
            flex:1,padding:10,borderRadius:8,border:sort===s.k?"2px solid var(--g4)":"2px solid var(--bdr)",
            background:sort===s.k?"var(--g7)":"var(--white)",color:sort===s.k?"white":"var(--ink3)",
            fontWeight:sort===s.k?700:400,fontSize:14,cursor:"pointer",fontFamily:"inherit"
          }}>{s.l}</button>
        ))}
      </div>

      {loading && <div style={{textAlign:"center",padding:40}}><span className="spinner" /></div>}
      {!loading && !connected && <div className="conn-status err">Spreadsheetæœªæ¥ç¶šã®ãŸã‚ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã§ãã¾ã›ã‚“</div>}
      {!loading && sorted.length===0 && connected && <p style={{textAlign:"center",color:"var(--ink4)",padding:40}}>ã‚¹ã‚³ã‚¢ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>}

      {sorted.map((r,i)=>{
        const rank=i+1,top3=rank<=3;
        return (
          <div key={`${r.group}-${r.name}`} style={{
            background:top3?"var(--gold3)":"var(--white)",border:top3?"2px solid var(--gold)":"1.5px solid var(--bdr)",
            borderRadius:12,padding:12,marginBottom:8,display:"flex",alignItems:"center",gap:10
          }}>
            <div style={{width:36,height:36,borderRadius:18,display:"flex",alignItems:"center",justifyContent:"center",
              background:top3?"var(--gold)":"var(--bg)",fontSize:top3?20:15,fontWeight:700,
              color:top3?"var(--g9)":"var(--ink3)",flexShrink:0}}>
              {top3?medals[rank-1]:rank}
            </div>
            <div style={{flex:1}}>
              <div style={{fontSize:15,fontWeight:700,color:"var(--ink)"}}>{r.name}</div>
              <div style={{fontSize:11,color:"var(--ink4)"}}>{r.group}çµ„</div>
            </div>
            <div style={{textAlign:"right",display:"flex",gap:14,alignItems:"baseline"}}>
              <div><div style={{fontSize:9,color:"var(--ink4)"}}>NET</div><div style={{fontSize:sort==="net"?22:16,fontWeight:700,color:sort==="net"?"var(--g7)":"var(--ink)"}}>{r.net}</div></div>
              <div><div style={{fontSize:9,color:"var(--ink4)"}}>GR</div><div style={{fontSize:sort==="gross"?22:16,fontWeight:700,color:sort==="gross"?"var(--g7)":"var(--ink)"}}>{r.gross}</div></div>
              <div><div style={{fontSize:9,color:"var(--ink4)"}}>HC</div><div style={{fontSize:14,fontWeight:600,color:"var(--g3)"}}>{r.hc}</div></div>
            </div>
          </div>
        );
      })}
    </div>
  </>);
}


ReactDOM.createRoot(document.getElementById('root')).render(<App />);
</script>
</body>
</html>
